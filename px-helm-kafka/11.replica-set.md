kafkaDB can run in a single node configuration as we showed and in a clustered configuration using replica sets (not to be confused with the Kubernetes Stateful Sets). A replica set is a group of kafkaDB instances that maintain the same data set. A replica set contains several data bearing nodes and optionally one arbiter node. Of the data bearing nodes, one and only one member is deemed the primary node, while the other nodes are deemed secondary nodes. This is documented [here](https://docs.kafkadb.com/manual/replication/).


### Step: Deploying a kafkaDB Replica Set with Kubernetes Stateful Set

Portworx supports Stateful Sets which allow you to deploy a kafkaDB replica set. With stateful sets the PVC are dynamically created based on a provided storage class. Try the following command to launch a 3 node kafkaDB replica set backed by Portworx volumes using the helm chart for kafkaDB replicasets:

```
helm install --name px --set persistentVolume.storageClass=px-ha-sc stable/kafkadb-replicaset
```{{execute T1}}

You can watch the 3 pods (px-kafkadb-replicaset-0, px-kafkadb-replicaset-1, px-kafkadb-replicaset-2) start up and initialize one by one:

```
watch kubectl get pods -o wide
```{{execute T1}}

Once they all started and are ready you can clear the screen by clicking ```clear```{{execute interrupt}}.

Get the volume list from pxctl, you should see 3 new 10GB volumes that were created:
```
kubectl exec -it $PX_POD -n kube-system -- /opt/pwx/bin/pxctl volume list
```{{execute T1}}

Check the health of all three cluster members using the following command:

```
for i in 0 1 2; do kubectl exec px-kafkadb-replicaset-$i -- sh -c 'kafka --eval="printjson(db.serverStatus())"'; done
```{{execute T1}}

That's a lot of JSON but if you look closely you will see that px-kafkadb-replicaset-0 should be your elected primary. You can connect to it and write/read data:

```
kubectl exec -it px-kafkadb-replicaset-0 -- kafka --host px-kafkadb-replicaset-0
```{{execute T1}}

You can learn more about what you can do with this helm chart here, feel free to keep using this shell to try out some of the commands listed:

https://github.com/kubernetes/charts/tree/master/stable/kafkadb-replicaset
